Description: Use dpkg-architecture instead of uname for detecting CPU
 This patch also fixes the following issues:
 - fix cross building of i386 on a machine with amd64 kernel (some buildds have
   this setup).
 - do not use 64-bit indexing on amd64
 - do not use -momit-leaf-frame-pointer GCC flag on non-x86 archs
Author: SÃ©bastien Villemot <sebastien@debian.org>
Forwarded: not-needed
Last-Update: 2013-01-16
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/deps/openlibm/Make.inc
+++ b/deps/openlibm/Make.inc
@@ -1,7 +1,7 @@
 # -*- mode: makefile-gmake -*-
 
 OS = $(shell uname)
-ARCH = $(shell uname -m)
+ARCH = $(shell dpkg-architecture -qDEB_HOST_ARCH_CPU)
 
 FC = gfortran
 
--- a/Make.inc
+++ b/Make.inc
@@ -43,12 +43,7 @@
 # Figure out OS and architecture
 BUILD_OS = $(shell uname)
 OS = $(BUILD_OS)
-ARCH = $(shell uname -m)
-
-# Use 64-bit libraries by default on 64-bit architectures
-ifeq ($(ARCH), x86_64)
-USE_LIB64 = 1
-endif
+ARCH = $(shell dpkg-architecture -qDEB_HOST_ARCH_CPU)
 
 USE_MKL = 0
 MKLLIB = /path/to/mkl/lib/intel64
@@ -107,7 +102,7 @@
 JCXXFLAGS = -pipe $(fPIC) -fno-rtti
 DEBUGFLAGS = -ggdb3 -DDEBUG
 SHIPFLAGS = -DNDEBUG -falign-functions
-ifneq ($(ARCH), ppc64)
+ifneq (,$(findstring $(ARCH),i386 amd64))
   SHIPFLAGS += -momit-leaf-frame-pointer
 endif
 endif
--- a/deps/Makefile
+++ b/deps/Makefile
@@ -530,7 +530,7 @@
 LIBRANDOM_CFLAGS = $(CFLAGS) -finline-functions -fomit-frame-pointer -DNDEBUG -fno-strict-aliasing \
 				   --param max-inline-insns-single=1800 -Wmissing-prototypes -Wall  -std=c99 \
 				   -DDSFMT_MEXP=19937 $(fPIC) -shared -DDSFMT_DO_NOT_USE_OLD_NAMES
-ifeq ($(ARCH), x86_64)
+ifeq ($(ARCH), amd64)
 LIBRANDOM_CFLAGS += -msse2 -DHAVE_SSE2
 endif
 
